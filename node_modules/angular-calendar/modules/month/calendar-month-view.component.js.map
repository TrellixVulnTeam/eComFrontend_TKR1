{"version":3,"file":"calendar-month-view.component.js","sources":["../../../src/modules/month/calendar-month-view.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Component,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy,\n  LOCALE_ID,\n  Inject,\n  TemplateRef\n} from '@angular/core';\nimport {\n  CalendarEvent,\n  WeekDay,\n  MonthView,\n  MonthViewDay,\n  ViewPeriod\n} from 'calendar-utils';\nimport { Subject, Subscription } from 'rxjs';\nimport isSameDay from 'date-fns/is_same_day/index';\nimport setDate from 'date-fns/set_date/index';\nimport setMonth from 'date-fns/set_month/index';\nimport setYear from 'date-fns/set_year/index';\nimport getDate from 'date-fns/get_date/index';\nimport getMonth from 'date-fns/get_month/index';\nimport getYear from 'date-fns/get_year/index';\nimport differenceInSeconds from 'date-fns/difference_in_seconds/index';\nimport addSeconds from 'date-fns/add_seconds/index';\nimport { CalendarEventTimesChangedEvent } from '../common/calendar-event-times-changed-event.interface';\nimport { CalendarUtils } from '../common/calendar-utils.provider';\nimport { validateEvents, trackByIndex } from '../common/util';\n\nexport interface CalendarMonthViewBeforeRenderEvent {\n  header: WeekDay[];\n  body: MonthViewDay[];\n  period: ViewPeriod;\n}\n\nexport interface CalendarMonthViewEventTimesChangedEvent\n  extends CalendarEventTimesChangedEvent {\n  day: MonthViewDay;\n}\n\n/**\n * Shows all events on a given month. Example usage:\n *\n * ```typescript\n * <mwl-calendar-month-view\n *  [viewDate]=\"viewDate\"\n *  [events]=\"events\">\n * </mwl-calendar-month-view>\n * ```\n */\n@Component({\n  selector: 'mwl-calendar-month-view',\n  template: `\n    <div class=\"cal-month-view\">\n      <mwl-calendar-month-view-header\n        [days]=\"columnHeaders\"\n        [locale]=\"locale\"\n        [customTemplate]=\"headerTemplate\">\n      </mwl-calendar-month-view-header>\n      <div class=\"cal-days\">\n        <div *ngFor=\"let rowIndex of view.rowOffsets; trackByIndex\">\n          <div class=\"cal-cell-row\">\n            <mwl-calendar-month-cell\n              *ngFor=\"let day of (view.days | slice : rowIndex : rowIndex + (view.totalDaysVisibleInWeek)); trackBy:trackByDate\"\n              [class.cal-drag-over]=\"day.dragOver\"\n              [ngClass]=\"day?.cssClass\"\n              [day]=\"day\"\n              [openDay]=\"openDay\"\n              [locale]=\"locale\"\n              [tooltipPlacement]=\"tooltipPlacement\"\n              [tooltipAppendToBody]=\"tooltipAppendToBody\"\n              [tooltipTemplate]=\"tooltipTemplate\"\n              [customTemplate]=\"cellTemplate\"\n              (click)=\"handleDayClick($event, day)\"\n              (highlightDay)=\"toggleDayHighlight($event.event, true)\"\n              (unhighlightDay)=\"toggleDayHighlight($event.event, false)\"\n              mwlDroppable\n              (dragEnter)=\"day.dragOver = true\"\n              (dragLeave)=\"day.dragOver = false\"\n              (drop)=\"day.dragOver = false; eventDropped(day, $event.dropData.event)\"\n              (eventClicked)=\"eventClicked.emit({event: $event.event})\">\n            </mwl-calendar-month-cell>\n          </div>\n          <mwl-calendar-open-day-events\n            [isOpen]=\"openRowIndex === rowIndex\"\n            [events]=\"openDay?.events\"\n            [customTemplate]=\"openDayEventsTemplate\"\n            [eventTitleTemplate]=\"eventTitleTemplate\"\n            (eventClicked)=\"eventClicked.emit({event: $event.event})\">\n          </mwl-calendar-open-day-events>\n        </div>\n      </div>\n    </div>\n  `\n})\nexport class CalendarMonthViewComponent\n  implements OnChanges, OnInit, OnDestroy {\n  /**\n   * The current view date\n   */\n  @Input() viewDate: Date;\n\n  /**\n   * An array of events to display on view.\n   * The schema is available here: https://github.com/mattlewis92/calendar-utils/blob/c51689985f59a271940e30bc4e2c4e1fee3fcb5c/src/calendarUtils.ts#L49-L63\n   */\n  @Input() events: CalendarEvent[] = [];\n\n  /**\n   * An array of day indexes (0 = sunday, 1 = monday etc) that will be hidden on the view\n   */\n  @Input() excludeDays: number[] = [];\n\n  /**\n   * Whether the events list for the day of the `viewDate` option is visible or not\n   */\n  @Input() activeDayIsOpen: boolean = false;\n\n  /**\n   * An observable that when emitted on will re-render the current view\n   */\n  @Input() refresh: Subject<any>;\n\n  /**\n   * The locale used to format dates\n   */\n  @Input() locale: string;\n\n  /**\n   * The placement of the event tooltip\n   */\n  @Input() tooltipPlacement: string = 'top';\n\n  /**\n   * A custom template to use for the event tooltips\n   */\n  @Input() tooltipTemplate: TemplateRef<any>;\n\n  /**\n   * Whether to append tooltips to the body or next to the trigger element\n   */\n  @Input() tooltipAppendToBody: boolean = true;\n\n  /**\n   * The start number of the week\n   */\n  @Input() weekStartsOn: number;\n\n  /**\n   * A custom template to use to replace the header\n   */\n  @Input() headerTemplate: TemplateRef<any>;\n\n  /**\n   * A custom template to use to replace the day cell\n   */\n  @Input() cellTemplate: TemplateRef<any>;\n\n  /**\n   * A custom template to use for the slide down box of events for the active day\n   */\n  @Input() openDayEventsTemplate: TemplateRef<any>;\n\n  /**\n   * A custom template to use for event titles\n   */\n  @Input() eventTitleTemplate: TemplateRef<any>;\n\n  /**\n   * An array of day indexes (0 = sunday, 1 = monday etc) that indicate which days are weekends\n   */\n  @Input() weekendDays: number[];\n\n  /**\n   * An output that will be called before the view is rendered for the current month.\n   * If you add the `cssClass` property to a day in the body it will add that class to the cell element in the template\n   */\n  @Output()\n  beforeViewRender = new EventEmitter<CalendarMonthViewBeforeRenderEvent>();\n\n  /**\n   * Called when the day cell is clicked\n   */\n  @Output()\n  dayClicked = new EventEmitter<{\n    day: MonthViewDay;\n  }>();\n\n  /**\n   * Called when the event title is clicked\n   */\n  @Output()\n  eventClicked = new EventEmitter<{\n    event: CalendarEvent;\n  }>();\n\n  /**\n   * Called when an event is dragged and dropped\n   */\n  @Output()\n  eventTimesChanged = new EventEmitter<\n    CalendarMonthViewEventTimesChangedEvent\n  >();\n\n  /**\n   * @hidden\n   */\n  columnHeaders: WeekDay[];\n\n  /**\n   * @hidden\n   */\n  view: MonthView;\n\n  /**\n   * @hidden\n   */\n  openRowIndex: number;\n\n  /**\n   * @hidden\n   */\n  openDay: MonthViewDay;\n\n  /**\n   * @hidden\n   */\n  refreshSubscription: Subscription;\n\n  /**\n   * @hidden\n   */\n  trackByIndex = trackByIndex;\n\n  /**\n   * @hidden\n   */\n  trackByDate = (index: number, day: MonthViewDay) => day.date.toISOString();\n\n  /**\n   * @hidden\n   */\n  constructor(\n    private cdr: ChangeDetectorRef,\n    private utils: CalendarUtils,\n    @Inject(LOCALE_ID) locale: string\n  ) {\n    this.locale = locale;\n  }\n\n  /**\n   * @hidden\n   */\n  ngOnInit(): void {\n    if (this.refresh) {\n      this.refreshSubscription = this.refresh.subscribe(() => {\n        this.refreshAll();\n        this.cdr.markForCheck();\n      });\n    }\n  }\n\n  /**\n   * @hidden\n   */\n  ngOnChanges(changes: any): void {\n    if (changes.viewDate || changes.excludeDays || changes.weekendDays) {\n      this.refreshHeader();\n    }\n\n    if (changes.events) {\n      validateEvents(this.events);\n    }\n\n    if (\n      changes.viewDate ||\n      changes.events ||\n      changes.excludeDays ||\n      changes.weekendDays\n    ) {\n      this.refreshBody();\n    }\n\n    if (\n      changes.activeDayIsOpen ||\n      changes.viewDate ||\n      changes.events ||\n      changes.excludeDays\n    ) {\n      this.checkActiveDayIsOpen();\n    }\n  }\n\n  /**\n   * @hidden\n   */\n  ngOnDestroy(): void {\n    if (this.refreshSubscription) {\n      this.refreshSubscription.unsubscribe();\n    }\n  }\n\n  /**\n   * @hidden\n   */\n  toggleDayHighlight(event: CalendarEvent, isHighlighted: boolean): void {\n    this.view.days.forEach(day => {\n      if (isHighlighted && day.events.indexOf(event) > -1) {\n        day.backgroundColor =\n          (event.color && event.color.secondary) || '#D1E8FF';\n      } else {\n        delete day.backgroundColor;\n      }\n    });\n  }\n\n  /**\n   * @hidden\n   */\n  eventDropped(day: MonthViewDay, event: CalendarEvent): void {\n    const year: number = getYear(day.date);\n    const month: number = getMonth(day.date);\n    const date: number = getDate(day.date);\n    const newStart: Date = setDate(\n      setMonth(setYear(event.start, year), month),\n      date\n    );\n    let newEnd: Date;\n    if (event.end) {\n      const secondsDiff: number = differenceInSeconds(newStart, event.start);\n      newEnd = addSeconds(event.end, secondsDiff);\n    }\n    this.eventTimesChanged.emit({ event, newStart, newEnd, day });\n  }\n\n  /**\n   * @hidden\n   */\n  handleDayClick(clickEvent: any, day: MonthViewDay) {\n    // when using hammerjs, stopPropagation doesn't work. See https://github.com/mattlewis92/angular-calendar/issues/318\n    if (!clickEvent.target.classList.contains('cal-event')) {\n      this.dayClicked.emit({ day });\n    }\n  }\n\n  private refreshHeader(): void {\n    this.columnHeaders = this.utils.getWeekViewHeader({\n      viewDate: this.viewDate,\n      weekStartsOn: this.weekStartsOn,\n      excluded: this.excludeDays,\n      weekendDays: this.weekendDays\n    });\n    this.emitBeforeViewRender();\n  }\n\n  private refreshBody(): void {\n    this.view = this.utils.getMonthView({\n      events: this.events,\n      viewDate: this.viewDate,\n      weekStartsOn: this.weekStartsOn,\n      excluded: this.excludeDays,\n      weekendDays: this.weekendDays\n    });\n    this.emitBeforeViewRender();\n  }\n\n  private checkActiveDayIsOpen(): void {\n    if (this.activeDayIsOpen === true) {\n      this.openDay = this.view.days.find(day =>\n        isSameDay(day.date, this.viewDate)\n      );\n      const index: number = this.view.days.indexOf(this.openDay);\n      this.openRowIndex =\n        Math.floor(index / this.view.totalDaysVisibleInWeek) *\n        this.view.totalDaysVisibleInWeek;\n    } else {\n      this.openRowIndex = null;\n      this.openDay = null;\n    }\n  }\n\n  private refreshAll(): void {\n    this.columnHeaders = null;\n    this.view = null;\n    this.refreshHeader();\n    this.refreshBody();\n    this.checkActiveDayIsOpen();\n  }\n\n  private emitBeforeViewRender(): void {\n    if (this.columnHeaders && this.view) {\n      this.beforeViewRender.emit({\n        header: this.columnHeaders,\n        body: this.view.days,\n        period: this.view.period\n      });\n    }\n  }\n}\n"]}