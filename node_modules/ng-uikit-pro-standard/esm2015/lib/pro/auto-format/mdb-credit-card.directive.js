import { Directive, HostListener, Input, HostBinding } from '@angular/core';
import * as ɵngcc0 from '@angular/core';
export class MdbCreditCardDirective {
    constructor() {
        this.standardPattern = /(\d{1,4})/g;
        this.defaultCard = {
            name: '',
            fullName: '',
            re: /\d{0,16}/,
            pattern: this.standardPattern,
            maxLength: 19,
            cvvLength: 3,
        };
        this.cards = [
            {
                name: 'visa',
                fullName: 'Visa',
                re: /^4\d{0,15}/,
                pattern: this.standardPattern,
                maxLength: 16,
                cvvLength: 3,
            },
            {
                name: 'mastercard',
                fullName: 'Mastercard',
                re: /^(5[1-5]\d{0,2}|22[2-9]\d{0,1}|2[3-7]\d{0,2})\d{0,12}/,
                pattern: this.standardPattern,
                maxLength: 16,
                cvvLength: 3,
            },
            {
                name: 'amex',
                fullName: 'American Express',
                re: /^3[47]\d{0,13}/,
                pattern: /(\d{1,4})(\d{1,6})?(\d{1,5})?/,
                maxLength: 15,
                cvvLength: 4,
            },
            {
                name: 'jcb',
                fullName: 'JCB',
                re: /^(?:35\d{0,2})\d{0,12}/,
                pattern: this.standardPattern,
                maxLength: 16,
                cvvLength: 3,
            },
            {
                name: 'discover',
                fullName: 'Discover',
                re: /^(?:6011|65\d{0,2}|64[4-9]\d?)\d{0,12}/,
                pattern: this.standardPattern,
                maxLength: 16,
                cvvLength: 3,
            },
            {
                name: 'diners-club',
                fullName: 'Diners Club',
                re: /^3(?:0([0-5]|9)|[689]\d?)\d{0,11}/,
                pattern: this.standardPattern,
                maxLength: 14,
                cvvLength: 3,
            },
        ];
        this._separator = ' ';
    }
    get additionalCards() {
        return this._additionalCards;
    }
    set additionalCards(cards) {
        this._additionalCards = cards;
        this.addCards(cards);
    }
    get separator() {
        return this._separator;
    }
    set separator(separator) {
        this._separator = separator;
    }
    onInput(event) {
        this.formatInput(event);
    }
    formatInput(event) {
        const input = event.target.value;
        const formattedInput = this.getFormattedInput(input);
        event.target.value = formattedInput;
    }
    getFormattedInput(value) {
        value = this.removeNonDigits(value);
        const card = this.findCardByNumber(value);
        this.updateCurrentCardNames(card.name, card.fullName);
        let cardNumMaxLength;
        if (this.hasStandardPattern(card)) {
            const matches = value.match(card.pattern);
            if (matches === null) {
                return value;
            }
            cardNumMaxLength = card.maxLength + matches.length - 1;
            this.maxLength = cardNumMaxLength.toString();
            return matches.join(this.separator);
        }
        else {
            const results = card.pattern.exec(value);
            if (results === null) {
                return value;
            }
            results.shift();
            cardNumMaxLength = card.maxLength + results.length - 1;
            this.maxLength = cardNumMaxLength.toString();
            return results.filter(this.isMatch).join(this.separator);
        }
    }
    removeNonDigits(value) {
        return value.replace(/\D/g, '');
    }
    hasStandardPattern(card) {
        return card.pattern.toString() === this.standardPattern.toString();
    }
    isMatch(match) {
        return match !== undefined;
    }
    updateCurrentCardNames(name, fullName) {
        this.cardName = name;
        this.cardFullName = fullName;
    }
    findCardByNumber(value) {
        const cardType = this.cards.find(card => {
            return card.re.test(value);
        });
        if (!cardType) {
            return this.defaultCard;
        }
        return cardType;
    }
    addCards(newCards) {
        newCards.forEach(card => {
            this.cards.push(card);
        });
    }
}
MdbCreditCardDirective.ɵfac = function MdbCreditCardDirective_Factory(t) { return new (t || MdbCreditCardDirective)(); };
MdbCreditCardDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: MdbCreditCardDirective, selectors: [["", "mdbCreditCard", ""]], hostVars: 1, hostBindings: function MdbCreditCardDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("input", function MdbCreditCardDirective_input_HostBindingHandler($event) { return ctx.onInput($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("maxLength", ctx.maxLength);
    } }, inputs: { additionalCards: "additionalCards", separator: "separator" }, exportAs: ["mdbCreditCard"] });
MdbCreditCardDirective.ctorParameters = () => [];
MdbCreditCardDirective.propDecorators = {
    additionalCards: [{ type: Input }],
    separator: [{ type: Input }],
    maxLength: [{ type: HostBinding, args: ['attr.maxLength',] }],
    onInput: [{ type: HostListener, args: ['input', ['$event'],] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(MdbCreditCardDirective, [{
        type: Directive,
        args: [{
                selector: '[mdbCreditCard]',
                exportAs: 'mdbCreditCard'
            }]
    }], function () { return []; }, { additionalCards: [{
            type: Input
        }], separator: [{
            type: Input
        }], onInput: [{
            type: HostListener,
            args: ['input', ['$event']]
        }], maxLength: [{
            type: HostBinding,
            args: ['attr.maxLength']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWRiLWNyZWRpdC1jYXJkLmRpcmVjdGl2ZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmctdWlraXQtcHJvLXN0YW5kYXJkL3NyYy9saWIvcHJvL2F1dG8tZm9ybWF0L21kYi1jcmVkaXQtY2FyZC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7QUFlNUUsTUFBTSxPQUFPLHNCQUFzQjtBQUNuQyxJQW1GRTtBQUFnQixRQW5GUixvQkFBZSxHQUFHLFlBQVksQ0FBQztBQUN6QyxRQUdVLGdCQUFXLEdBQWU7QUFDcEMsWUFBSSxJQUFJLEVBQUUsRUFBRTtBQUNaLFlBQUksUUFBUSxFQUFFLEVBQUU7QUFDaEIsWUFBSSxFQUFFLEVBQUUsVUFBVTtBQUNsQixZQUFJLE9BQU8sRUFBRSxJQUFJLENBQUMsZUFBZTtBQUNqQyxZQUFJLFNBQVMsRUFBRSxFQUFFO0FBQ2pCLFlBQUksU0FBUyxFQUFFLENBQUM7QUFDaEIsU0FBRyxDQUFDO0FBQ0osUUFDVSxVQUFLLEdBQWlCO0FBQ2hDLFlBQUk7QUFDSixnQkFBTSxJQUFJLEVBQUUsTUFBTTtBQUNsQixnQkFBTSxRQUFRLEVBQUUsTUFBTTtBQUN0QixnQkFBTSxFQUFFLEVBQUUsWUFBWTtBQUN0QixnQkFBTSxPQUFPLEVBQUUsSUFBSSxDQUFDLGVBQWU7QUFDbkMsZ0JBQU0sU0FBUyxFQUFFLEVBQUU7QUFDbkIsZ0JBQU0sU0FBUyxFQUFFLENBQUM7QUFDbEIsYUFBSztBQUNMLFlBQUk7QUFDSixnQkFBTSxJQUFJLEVBQUUsWUFBWTtBQUN4QixnQkFBTSxRQUFRLEVBQUUsWUFBWTtBQUM1QixnQkFBTSxFQUFFLEVBQUUsdURBQXVEO0FBQ2pFLGdCQUFNLE9BQU8sRUFBRSxJQUFJLENBQUMsZUFBZTtBQUNuQyxnQkFBTSxTQUFTLEVBQUUsRUFB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U0FDM0IsUUFBUSxFQUFFLGVBQWUsZUFDMUI7Ozs7Z0hBQ0k7QUFBQztBQUNZO0FBQ0EsOEJBK0RmLEtBQUs7QUFDTix3QkFTQyxLQUFLO0FBQ04sd0JBVUMsV0FBVyxTQUFDLGdCQUFnQjtBQUFPLHNCQUVuQyxZQUFZLFNBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxDQUFDO0FBQy9COzs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBIb3N0TGlzdGVuZXIsIElucHV0LCBIb3N0QmluZGluZyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5leHBvcnQgaW50ZXJmYWNlIENyZWRpdENhcmQge1xuICBuYW1lOiBzdHJpbmc7XG4gIGZ1bGxOYW1lOiBzdHJpbmc7XG4gIHJlOiBSZWdFeHA7XG4gIHBhdHRlcm46IFJlZ0V4cDtcbiAgbWF4TGVuZ3RoOiBudW1iZXI7XG4gIGN2dkxlbmd0aDogbnVtYmVyO1xufVxuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbbWRiQ3JlZGl0Q2FyZF0nLFxuICBleHBvcnRBczogJ21kYkNyZWRpdENhcmQnLFxufSlcbmV4cG9ydCBjbGFzcyBNZGJDcmVkaXRDYXJkRGlyZWN0aXZlIHtcbiAgcHJpdmF0ZSBzdGFuZGFyZFBhdHRlcm4gPSAvKFxcZHsxLDR9KS9nO1xuICBjYXJkTmFtZTogc3RyaW5nO1xuICBjYXJkRnVsbE5hbWU6IHN0cmluZztcblxuICBwcml2YXRlIGRlZmF1bHRDYXJkOiBDcmVkaXRDYXJkID0ge1xuICAgIG5hbWU6ICcnLFxuICAgIGZ1bGxOYW1lOiAnJyxcbiAgICByZTogL1xcZHswLDE2fS8sXG4gICAgcGF0dGVybjogdGhpcy5zdGFuZGFyZFBhdHRlcm4sXG4gICAgbWF4TGVuZ3RoOiAxOSxcbiAgICBjdnZMZW5ndGg6IDMsXG4gIH07XG5cbiAgcHJpdmF0ZSBjYXJkczogQ3JlZGl0Q2FyZFtdID0gW1xuICAgIHtcbiAgICAgIG5hbWU6ICd2aXNhJyxcbiAgICAgIGZ1bGxOYW1lOiAnVmlzYScsXG4gICAgICByZTogL140XFxkezAsMTV9LyxcbiAgICAgIHBhdHRlcm46IHRoaXMuc3RhbmRhcmRQYXR0ZXJuLFxuICAgICAgbWF4TGVuZ3RoOiAxNixcbiAgICAgIGN2dkxlbmd0aDogMyxcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6ICdtYXN0ZXJjYXJkJyxcbiAgICAgIGZ1bGxOYW1lOiAnTWFzdGVyY2FyZCcsXG4gICAgICByZTogL14oNVsxLTVdXFxkezAsMn18MjJbMi05XVxcZHswLDF9fDJbMy03XVxcZHswLDJ9KVxcZHswLDEyfS8sXG4gICAgICBwYXR0ZXJuOiB0aGlzLnN0YW5kYXJkUGF0dGVybixcbiAgICAgIG1heExlbmd0aDogMTYsXG4gICAgICBjdnZMZW5ndGg6IDMsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiAnYW1leCcsXG4gICAgICBmdWxsTmFtZTogJ0FtZXJpY2FuIEV4cHJlc3MnLFxuICAgICAgcmU6IC9eM1s0N11cXGR7MCwxM30vLFxuICAgICAgcGF0dGVybjogLyhcXGR7MSw0fSkoXFxkezEsNn0pPyhcXGR7MSw1fSk/LyxcbiAgICAgIG1heExlbmd0aDogMTUsXG4gICAgICBjdnZMZW5ndGg6IDQsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiAnamNiJyxcbiAgICAgIGZ1bGxOYW1lOiAnSkNCJyxcbiAgICAgIHJlOiAvXig/OjM1XFxkezAsMn0pXFxkezAsMTJ9LyxcbiAgICAgIHBhdHRlcm46IHRoaXMuc3RhbmRhcmRQYXR0ZXJuLFxuICAgICAgbWF4TGVuZ3RoOiAxNixcbiAgICAgIGN2dkxlbmd0aDogMyxcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6ICdkaXNjb3ZlcicsXG4gICAgICBmdWxsTmFtZTogJ0Rpc2NvdmVyJyxcbiAgICAgIHJlOiAvXig/OjYwMTF8NjVcXGR7MCwyfXw2NFs0LTldXFxkPylcXGR7MCwxMn0vLFxuICAgICAgcGF0dGVybjogdGhpcy5zdGFuZGFyZFBhdHRlcm4sXG4gICAgICBtYXhMZW5ndGg6IDE2LFxuICAgICAgY3Z2TGVuZ3RoOiAzLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ2RpbmVycy1jbHViJyxcbiAgICAgIGZ1bGxOYW1lOiAnRGluZXJzIENsdWInLFxuICAgICAgcmU6IC9eMyg/OjAoWzAtNV18OSl8WzY4OV1cXGQ/KVxcZHswLDExfS8sXG4gICAgICBwYXR0ZXJuOiB0aGlzLnN0YW5kYXJkUGF0dGVybixcbiAgICAgIG1heExlbmd0aDogMTQsXG4gICAgICBjdnZMZW5ndGg6IDMsXG4gICAgfSxcbiAgXTtcblxuICBASW5wdXQoKVxuICBnZXQgYWRkaXRpb25hbENhcmRzKCkge1xuICAgIHJldHVybiB0aGlzLl9hZGRpdGlvbmFsQ2FyZHM7XG4gIH1cbiAgc2V0IGFkZGl0aW9uYWxDYXJkcyhjYXJkczogQ3JlZGl0Q2FyZFtdKSB7XG4gICAgdGhpcy5fYWRkaXRpb25hbENhcmRzID0gY2FyZHM7XG4gICAgdGhpcy5hZGRDYXJkcyhjYXJkcyk7XG4gIH1cbiAgcHJpdmF0ZSBfYWRkaXRpb25hbENhcmRzOiBDcmVkaXRDYXJkW107XG5cbiAgQElucHV0KClcbiAgZ2V0IHNlcGFyYXRvcigpIHtcbiAgICByZXR1cm4gdGhpcy5fc2VwYXJhdG9yO1xuICB9XG4gIHNldCBzZXBhcmF0b3Ioc2VwYXJhdG9yOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9zZXBhcmF0b3IgPSBzZXBhcmF0b3I7XG4gIH1cbiAgcHJpdmF0ZSBfc2VwYXJhdG9yID0gJyAnO1xuXG4gIGNvbnN0cnVjdG9yKCkge31cblxuICBASG9zdEJpbmRpbmcoJ2F0dHIubWF4TGVuZ3RoJykgbWF4TGVuZ3RoOiBzdHJpbmc7XG5cbiAgQEhvc3RMaXN0ZW5lcignaW5wdXQnLCBbJyRldmVudCddKVxuICBvbklucHV0KGV2ZW50OiBhbnkpIHtcbiAgICB0aGlzLmZvcm1hdElucHV0KGV2ZW50KTtcbiAgfVxuXG4gIHByaXZhdGUgZm9ybWF0SW5wdXQoZXZlbnQ6IGFueSkge1xuICAgIGNvbnN0IGlucHV0ID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgIGNvbnN0IGZvcm1hdHRlZElucHV0ID0gdGhpcy5nZXRGb3JtYXR0ZWRJbnB1dChpbnB1dCk7XG4gICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gZm9ybWF0dGVkSW5wdXQ7XG4gIH1cblxuICBwcml2YXRlIGdldEZvcm1hdHRlZElucHV0KHZhbHVlOiBzdHJpbmcpIHtcbiAgICB2YWx1ZSA9IHRoaXMucmVtb3ZlTm9uRGlnaXRzKHZhbHVlKTtcbiAgICBjb25zdCBjYXJkID0gdGhpcy5maW5kQ2FyZEJ5TnVtYmVyKHZhbHVlKTtcblxuICAgIHRoaXMudXBkYXRlQ3VycmVudENhcmROYW1lcyhjYXJkLm5hbWUsIGNhcmQuZnVsbE5hbWUpO1xuXG4gICAgbGV0IGNhcmROdW1NYXhMZW5ndGg6IG51bWJlcjtcblxuICAgIGlmICh0aGlzLmhhc1N0YW5kYXJkUGF0dGVybihjYXJkKSkge1xuICAgICAgY29uc3QgbWF0Y2hlczogUmVnRXhwTWF0Y2hBcnJheSB8IG51bGwgPSB2YWx1ZS5tYXRjaChjYXJkLnBhdHRlcm4pO1xuXG4gICAgICBpZiAobWF0Y2hlcyA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9XG5cbiAgICAgIGNhcmROdW1NYXhMZW5ndGggPSBjYXJkLm1heExlbmd0aCArIG1hdGNoZXMubGVuZ3RoIC0gMTtcbiAgICAgIHRoaXMubWF4TGVuZ3RoID0gY2FyZE51bU1heExlbmd0aC50b1N0cmluZygpO1xuICAgICAgcmV0dXJuIG1hdGNoZXMuam9pbih0aGlzLnNlcGFyYXRvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHJlc3VsdHM6IFJlZ0V4cEV4ZWNBcnJheSB8IG51bGwgPSBjYXJkLnBhdHRlcm4uZXhlYyh2YWx1ZSk7XG5cbiAgICAgIGlmIChyZXN1bHRzID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIHJlc3VsdHMuc2hpZnQoKTtcbiAgICAgIGNhcmROdW1NYXhMZW5ndGggPSBjYXJkLm1heExlbmd0aCArIHJlc3VsdHMubGVuZ3RoIC0gMTtcbiAgICAgIHRoaXMubWF4TGVuZ3RoID0gY2FyZE51bU1heExlbmd0aC50b1N0cmluZygpO1xuICAgICAgcmV0dXJuIHJlc3VsdHMuZmlsdGVyKHRoaXMuaXNNYXRjaCkuam9pbih0aGlzLnNlcGFyYXRvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVOb25EaWdpdHModmFsdWU6IHN0cmluZykge1xuICAgIHJldHVybiB2YWx1ZS5yZXBsYWNlKC9cXEQvZywgJycpO1xuICB9XG5cbiAgcHJpdmF0ZSBoYXNTdGFuZGFyZFBhdHRlcm4oY2FyZDogQ3JlZGl0Q2FyZCkge1xuICAgIHJldHVybiBjYXJkLnBhdHRlcm4udG9TdHJpbmcoKSA9PT0gdGhpcy5zdGFuZGFyZFBhdHRlcm4udG9TdHJpbmcoKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNNYXRjaChtYXRjaDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIG1hdGNoICE9PSB1bmRlZmluZWQ7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUN1cnJlbnRDYXJkTmFtZXMobmFtZTogc3RyaW5nLCBmdWxsTmFtZTogc3RyaW5nKSB7XG4gICAgdGhpcy5jYXJkTmFtZSA9IG5hbWU7XG4gICAgdGhpcy5jYXJkRnVsbE5hbWUgPSBmdWxsTmFtZTtcbiAgfVxuXG4gIHByaXZhdGUgZmluZENhcmRCeU51bWJlcih2YWx1ZTogc3RyaW5nKSB7XG4gICAgY29uc3QgY2FyZFR5cGUgPSB0aGlzLmNhcmRzLmZpbmQoY2FyZCA9PiB7XG4gICAgICByZXR1cm4gY2FyZC5yZS50ZXN0KHZhbHVlKTtcbiAgICB9KTtcblxuICAgIGlmICghY2FyZFR5cGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRDYXJkO1xuICAgIH1cblxuICAgIHJldHVybiBjYXJkVHlwZTtcbiAgfVxuXG4gIHB1YmxpYyBhZGRDYXJkcyhuZXdDYXJkczogQ3JlZGl0Q2FyZFtdKSB7XG4gICAgbmV3Q2FyZHMuZm9yRWFjaChjYXJkID0+IHtcbiAgICAgIHRoaXMuY2FyZHMucHVzaChjYXJkKTtcbiAgICB9KTtcbiAgfVxufVxuIl19