import * as ɵngcc0 from '@angular/core';
'use strict';
import { Directive, ElementRef, Input } from '@angular/core';
import { computedStyle } from './computed.style';
import { isPlatformBrowser } from '@angular/common';
import { PLATFORM_ID, Inject } from '@angular/core';
export class MdbStickyDirective {
    constructor(el, platformId) {
        this.isBrowser = false;
        this.stickyOffsetTop = 0;
        this.scrollHandler = () => {
            const parentRect = this.el.parentElement.getBoundingClientRect();
            const bodyRect = document.body.getBoundingClientRect();
            let dynProps;
            if (this.original.float === 'right') {
                const right = bodyRect.right - parentRect.right + this.original.marginRight;
                dynProps = { right: right + 'px' };
            }
            else if (this.original.float === 'left') {
                const left = parentRect.left - bodyRect.left + this.original.marginLeft;
                dynProps = { left: left + 'px' };
            }
            else {
                dynProps = { width: parentRect.width + 'px' };
            }
            if (this.original.marginTop +
                this.original.marginBottom +
                this.original.boundingClientRect.height +
                this.stickyOffsetTop >=
                parentRect.bottom) {
                /**
                 * stikcy element reached to the bottom of the container
                 */
                const floatAdjustment = this.original.float === 'right'
                    ? { right: 0 }
                    : this.original.float === 'left'
                        ? { left: 0 }
                        : {};
                Object.assign(this.el.style, {
                    position: 'absolute',
                    float: 'none',
                    top: 'inherit',
                    bottom: 0,
                }, dynProps, floatAdjustment);
            }
            else if (parentRect.top * -1 + this.original.marginTop + this.stickyOffsetTop >
                this.original.offsetTop) {
                /**
                 * stikcy element is in the middle of container
                 */
                // if not floating, add an empty filler element, since the original elements becames 'fixed'
                if (this.original.float !== 'left' && this.original.float !== 'right' && !this.fillerEl) {
                    this.fillerEl = document.createElement('div');
                    this.fillerEl.style.height = this.el.offsetHeight + 'px';
                    this.parentEl.insertBefore(this.fillerEl, this.el);
                }
                Object.assign(this.el.style, {
                    position: 'fixed',
                    float: 'none',
                    top: this.stickyOffsetTop + 'px',
                    bottom: 'inherit',
                }, dynProps);
            }
            else {
                /**
                 * stikcy element is in the original position
                 */
                if (this.fillerEl) {
                    this.parentEl.removeChild(this.fillerEl); // IE11 does not work with el.remove()
                    this.fillerEl = undefined;
                }
                Object.assign(this.el.style, {
                    position: this.original.position,
                    float: this.original.float,
                    top: this.original.top,
                    bottom: this.original.bottom,
                    width: this.original.width,
                    left: this.original.left,
                }, dynProps);
            }
        };
        this.el = this.el = el.nativeElement;
        this.parentEl = this.el.parentElement;
        this.isBrowser = isPlatformBrowser(platformId);
    }
    ngAfterViewInit() {
        this.el.style.boxSizing = 'border-box';
        if (this.stickyAfter) {
            const cetStickyAfterEl = document.querySelector(this.stickyAfter);
            if (cetStickyAfterEl) {
                this.stickyOffsetTop = cetStickyAfterEl.getBoundingClientRect().bottom;
            }
        }
        if (this.stickyAfterAlias) {
            const cetStickyAfterEl = document.querySelector(this.stickyAfterAlias);
            if (cetStickyAfterEl) {
                this.stickyOffsetTop = cetStickyAfterEl.getBoundingClientRect().bottom;
            }
        }
        // set the parent relatively positioned
        const allowedPositions = ['absolute', 'fixed', 'relative'];
        const parentElPosition = computedStyle(this.parentEl, 'position');
        if (allowedPositions.indexOf(parentElPosition) === -1) {
            // inherit, initial, unset
            this.parentEl.style.position = 'relative';
        }
        this.diff = {
            top: this.el.offsetTop - this.parentEl.offsetTop,
            left: this.el.offsetLeft - this.parentEl.offsetLeft,
        };
        if (this.isBrowser) {
            const elRect = this.el.getBoundingClientRect();
            this.el.getBoundingClientRect();
            this.original = {
                boundingClientRect: elRect,
                position: computedStyle(this.el, 'position'),
                float: computedStyle(this.el, 'float'),
                top: computedStyle(this.el, 'top'),
                bottom: computedStyle(this.el, 'bottom'),
                width: computedStyle(this.el, 'width'),
                left: '',
                offsetTop: this.el.offsetTop,
                offsetLeft: this.el.offsetLeft,
                marginTop: parseInt(computedStyle(this.el, 'marginTop'), 10),
                marginBottom: parseInt(computedStyle(this.el, 'marginBottom'), 10),
                marginLeft: parseInt(computedStyle(this.el, 'marginLeft'), 10),
                marginRight: parseInt(computedStyle(this.el, 'marginLeft'), 10),
            };
        }
        this.attach();
    }
    ngOnDestroy() {
        this.detach();
    }
    attach() {
        window.addEventListener('scroll', this.scrollHandler);
        window.addEventListener('resize', this.scrollHandler);
    }
    detach() {
        window.removeEventListener('scroll', this.scrollHandler);
        window.removeEventListener('resize', this.scrollHandler);
    }
}
MdbStickyDirective.ɵfac = function MdbStickyDirective_Factory(t) { return new (t || MdbStickyDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(PLATFORM_ID)); };
MdbStickyDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: MdbStickyDirective, selectors: [["", "mdbSticky", ""]], inputs: { stickyAfter: "stickyAfter", stickyAfterAlias: ["sticky-after", "stickyAfterAlias"] } });
MdbStickyDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: String, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
];
MdbStickyDirective.propDecorators = {
    stickyAfter: [{ type: Input }],
    stickyAfterAlias: [{ type: Input, args: ['sticky-after',] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(MdbStickyDirective, [{
        type: Directive,
        args: [{
                selector: '[mdbSticky]'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: String, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }]; }, { stickyAfter: [{
            type: Input
        }], stickyAfterAlias: [{
            type: Input,
            args: ['sticky-after']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RpY2t5LWNvbnRlbnQuZGlyZWN0aXZlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy11aWtpdC1wcm8tc3RhbmRhcmQvc3JjL2xpYi9wcm8vc3RpY2t5LWNvbnRlbnQvc3RpY2t5LWNvbnRlbnQuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxZQUFZLENBQUM7QUFFYixPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQTRCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZGLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUVqRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUtwRCxNQUFNLE9BQU8sa0JBQWtCO0FBQUcsSUFjaEMsWUFBWSxFQUFjLEVBQXVCLFVBQWtCO0FBQ3JFLFFBWEUsY0FBUyxHQUFHLEtBQUssQ0FBQztBQUNwQixRQUlFLG9CQUFlLEdBQUcsQ0FBQyxDQUFDO0FBQ3RCLFFBNkVFLGtCQUFhLEdBQUcsR0FBRyxFQUFFO0FBQ3ZCLFlBQUksTUFBTSxVQUFVLEdBQWUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMscUJBQXFCLEVBQUUsQ0FBQztBQUNqRixZQUFJLE1BQU0sUUFBUSxHQUFlLFFBQVEsQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztBQUN2RSxZQUFJLElBQUksUUFBUSxDQUFDO0FBQ2pCLFlBQ0ksSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssS0FBSyxPQUFPLEVBQUU7QUFDekMsZ0JBQU0sTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLEtBQUssR0FBRyxVQUFVLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDO0FBQ2xGLGdCQUFNLFFBQVEsR0FBRyxFQUFF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eyBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIElucHV0LCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGNvbXB1dGVkU3R5bGUgfSBmcm9tICcuL2NvbXB1dGVkLnN0eWxlJztcblxuaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgUExBVEZPUk1fSUQsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbbWRiU3RpY2t5XScsXG59KVxuZXhwb3J0IGNsYXNzIE1kYlN0aWNreURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCB7XG4gIEBJbnB1dCgpIHN0aWNreUFmdGVyOiBzdHJpbmc7IC8vIGNzcyBzZWxlY3RvciB0byBiZSBzdGlja3kgYWZ0ZXJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWlucHV0LXJlbmFtZVxuICBASW5wdXQoJ3N0aWNreS1hZnRlcicpIHN0aWNreUFmdGVyQWxpYXM6IHN0cmluZzsgLy8gY3NzIHNlbGVjdG9yIHRvIGJlIHN0aWNreSBhZnRlclxuICBpc0Jyb3dzZXIgPSBmYWxzZTtcblxuICBlbDogSFRNTEVsZW1lbnQgfCBhbnk7XG4gIHBhcmVudEVsOiBIVE1MRWxlbWVudCB8IGFueTtcbiAgZmlsbGVyRWw6IEhUTUxFbGVtZW50IHwgYW55O1xuICBzdGlja3lPZmZzZXRUb3AgPSAwO1xuXG4gIGRpZmY6IGFueTtcbiAgb3JpZ2luYWw6IGFueTtcblxuICBjb25zdHJ1Y3RvcihlbDogRWxlbWVudFJlZiwgQEluamVjdChQTEFURk9STV9JRCkgcGxhdGZvcm1JZDogc3RyaW5nKSB7XG4gICAgdGhpcy5lbCA9IHRoaXMuZWwgPSBlbC5uYXRpdmVFbGVtZW50O1xuICAgIHRoaXMucGFyZW50RWwgPSB0aGlzLmVsLnBhcmVudEVsZW1lbnQ7XG4gICAgdGhpcy5pc0Jyb3dzZXIgPSBpc1BsYXRmb3JtQnJvd3NlcihwbGF0Zm9ybUlkKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmVsLnN0eWxlLmJveFNpemluZyA9ICdib3JkZXItYm94JztcblxuICAgIGlmICh0aGlzLnN0aWNreUFmdGVyKSB7XG4gICAgICBjb25zdCBjZXRTdGlja3lBZnRlckVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLnN0aWNreUFmdGVyKTtcbiAgICAgIGlmIChjZXRTdGlja3lBZnRlckVsKSB7XG4gICAgICAgIHRoaXMuc3RpY2t5T2Zmc2V0VG9wID0gY2V0U3RpY2t5QWZ0ZXJFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5ib3R0b207XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc3RpY2t5QWZ0ZXJBbGlhcykge1xuICAgICAgY29uc3QgY2V0U3RpY2t5QWZ0ZXJFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5zdGlja3lBZnRlckFsaWFzKTtcbiAgICAgIGlmIChjZXRTdGlja3lBZnRlckVsKSB7XG4gICAgICAgIHRoaXMuc3RpY2t5T2Zmc2V0VG9wID0gY2V0U3RpY2t5QWZ0ZXJFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5ib3R0b207XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gc2V0IHRoZSBwYXJlbnQgcmVsYXRpdmVseSBwb3NpdGlvbmVkXG4gICAgY29uc3QgYWxsb3dlZFBvc2l0aW9ucyA9IFsnYWJzb2x1dGUnLCAnZml4ZWQnLCAncmVsYXRpdmUnXTtcbiAgICBjb25zdCBwYXJlbnRFbFBvc2l0aW9uID0gY29tcHV0ZWRTdHlsZSh0aGlzLnBhcmVudEVsLCAncG9zaXRpb24nKTtcbiAgICBpZiAoYWxsb3dlZFBvc2l0aW9ucy5pbmRleE9mKHBhcmVudEVsUG9zaXRpb24pID09PSAtMSkge1xuICAgICAgLy8gaW5oZXJpdCwgaW5pdGlhbCwgdW5zZXRcbiAgICAgIHRoaXMucGFyZW50RWwuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnO1xuICAgIH1cblxuICAgIHRoaXMuZGlmZiA9IHtcbiAgICAgIHRvcDogdGhpcy5lbC5vZmZzZXRUb3AgLSB0aGlzLnBhcmVudEVsLm9mZnNldFRvcCxcbiAgICAgIGxlZnQ6IHRoaXMuZWwub2Zmc2V0TGVmdCAtIHRoaXMucGFyZW50RWwub2Zmc2V0TGVmdCxcbiAgICB9O1xuXG4gICAgaWYgKHRoaXMuaXNCcm93c2VyKSB7XG4gICAgICBjb25zdCBlbFJlY3QgPSB0aGlzLmVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgdGhpcy5lbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIHRoaXMub3JpZ2luYWwgPSB7XG4gICAgICAgIGJvdW5kaW5nQ2xpZW50UmVjdDogZWxSZWN0LFxuICAgICAgICBwb3NpdGlvbjogY29tcHV0ZWRTdHlsZSh0aGlzLmVsLCAncG9zaXRpb24nKSxcbiAgICAgICAgZmxvYXQ6IGNvbXB1dGVkU3R5bGUodGhpcy5lbCwgJ2Zsb2F0JyksXG4gICAgICAgIHRvcDogY29tcHV0ZWRTdHlsZSh0aGlzLmVsLCAndG9wJyksXG4gICAgICAgIGJvdHRvbTogY29tcHV0ZWRTdHlsZSh0aGlzLmVsLCAnYm90dG9tJyksXG4gICAgICAgIHdpZHRoOiBjb21wdXRlZFN0eWxlKHRoaXMuZWwsICd3aWR0aCcpLFxuICAgICAgICBsZWZ0OiAnJyxcbiAgICAgICAgb2Zmc2V0VG9wOiB0aGlzLmVsLm9mZnNldFRvcCxcbiAgICAgICAgb2Zmc2V0TGVmdDogdGhpcy5lbC5vZmZzZXRMZWZ0LFxuICAgICAgICBtYXJnaW5Ub3A6IHBhcnNlSW50KGNvbXB1dGVkU3R5bGUodGhpcy5lbCwgJ21hcmdpblRvcCcpLCAxMCksXG4gICAgICAgIG1hcmdpbkJvdHRvbTogcGFyc2VJbnQoY29tcHV0ZWRTdHlsZSh0aGlzLmVsLCAnbWFyZ2luQm90dG9tJyksIDEwKSxcbiAgICAgICAgbWFyZ2luTGVmdDogcGFyc2VJbnQoY29tcHV0ZWRTdHlsZSh0aGlzLmVsLCAnbWFyZ2luTGVmdCcpLCAxMCksXG4gICAgICAgIG1hcmdpblJpZ2h0OiBwYXJzZUludChjb21wdXRlZFN0eWxlKHRoaXMuZWwsICdtYXJnaW5MZWZ0JyksIDEwKSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgdGhpcy5hdHRhY2goKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuZGV0YWNoKCk7XG4gIH1cblxuICBhdHRhY2goKTogdm9pZCB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMuc2Nyb2xsSGFuZGxlcik7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMuc2Nyb2xsSGFuZGxlcik7XG4gIH1cblxuICBkZXRhY2goKTogdm9pZCB7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMuc2Nyb2xsSGFuZGxlcik7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMuc2Nyb2xsSGFuZGxlcik7XG4gIH1cblxuICBzY3JvbGxIYW5kbGVyID0gKCkgPT4ge1xuICAgIGNvbnN0IHBhcmVudFJlY3Q6IENsaWVudFJlY3QgPSB0aGlzLmVsLnBhcmVudEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgY29uc3QgYm9keVJlY3Q6IENsaWVudFJlY3QgPSBkb2N1bWVudC5ib2R5LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGxldCBkeW5Qcm9wcztcblxuICAgIGlmICh0aGlzLm9yaWdpbmFsLmZsb2F0ID09PSAncmlnaHQnKSB7XG4gICAgICBjb25zdCByaWdodCA9IGJvZHlSZWN0LnJpZ2h0IC0gcGFyZW50UmVjdC5yaWdodCArIHRoaXMub3JpZ2luYWwubWFyZ2luUmlnaHQ7XG4gICAgICBkeW5Qcm9wcyA9IHsgcmlnaHQ6IHJpZ2h0ICsgJ3B4JyB9O1xuICAgIH0gZWxzZSBpZiAodGhpcy5vcmlnaW5hbC5mbG9hdCA9PT0gJ2xlZnQnKSB7XG4gICAgICBjb25zdCBsZWZ0ID0gcGFyZW50UmVjdC5sZWZ0IC0gYm9keVJlY3QubGVmdCArIHRoaXMub3JpZ2luYWwubWFyZ2luTGVmdDtcbiAgICAgIGR5blByb3BzID0geyBsZWZ0OiBsZWZ0ICsgJ3B4JyB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBkeW5Qcm9wcyA9IHsgd2lkdGg6IHBhcmVudFJlY3Qud2lkdGggKyAncHgnIH07XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgdGhpcy5vcmlnaW5hbC5tYXJnaW5Ub3AgK1xuICAgICAgICB0aGlzLm9yaWdpbmFsLm1hcmdpbkJvdHRvbSArXG4gICAgICAgIHRoaXMub3JpZ2luYWwuYm91bmRpbmdDbGllbnRSZWN0LmhlaWdodCArXG4gICAgICAgIHRoaXMuc3RpY2t5T2Zmc2V0VG9wID49XG4gICAgICBwYXJlbnRSZWN0LmJvdHRvbVxuICAgICkge1xuICAgICAgLyoqXG4gICAgICAgKiBzdGlrY3kgZWxlbWVudCByZWFjaGVkIHRvIHRoZSBib3R0b20gb2YgdGhlIGNvbnRhaW5lclxuICAgICAgICovXG4gICAgICBjb25zdCBmbG9hdEFkanVzdG1lbnQgPVxuICAgICAgICB0aGlzLm9yaWdpbmFsLmZsb2F0ID09PSAncmlnaHQnXG4gICAgICAgICAgPyB7IHJpZ2h0OiAwIH1cbiAgICAgICAgICA6IHRoaXMub3JpZ2luYWwuZmxvYXQgPT09ICdsZWZ0J1xuICAgICAgICAgID8geyBsZWZ0OiAwIH1cbiAgICAgICAgICA6IHt9O1xuICAgICAgT2JqZWN0LmFzc2lnbihcbiAgICAgICAgdGhpcy5lbC5zdHlsZSxcbiAgICAgICAge1xuICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgIGZsb2F0OiAnbm9uZScsXG4gICAgICAgICAgdG9wOiAnaW5oZXJpdCcsXG4gICAgICAgICAgYm90dG9tOiAwLFxuICAgICAgICB9LFxuICAgICAgICBkeW5Qcm9wcyxcbiAgICAgICAgZmxvYXRBZGp1c3RtZW50XG4gICAgICApO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBwYXJlbnRSZWN0LnRvcCAqIC0xICsgdGhpcy5vcmlnaW5hbC5tYXJnaW5Ub3AgKyB0aGlzLnN0aWNreU9mZnNldFRvcCA+XG4gICAgICB0aGlzLm9yaWdpbmFsLm9mZnNldFRvcFxuICAgICkge1xuICAgICAgLyoqXG4gICAgICAgKiBzdGlrY3kgZWxlbWVudCBpcyBpbiB0aGUgbWlkZGxlIG9mIGNvbnRhaW5lclxuICAgICAgICovXG5cbiAgICAgIC8vIGlmIG5vdCBmbG9hdGluZywgYWRkIGFuIGVtcHR5IGZpbGxlciBlbGVtZW50LCBzaW5jZSB0aGUgb3JpZ2luYWwgZWxlbWVudHMgYmVjYW1lcyAnZml4ZWQnXG4gICAgICBpZiAodGhpcy5vcmlnaW5hbC5mbG9hdCAhPT0gJ2xlZnQnICYmIHRoaXMub3JpZ2luYWwuZmxvYXQgIT09ICdyaWdodCcgJiYgIXRoaXMuZmlsbGVyRWwpIHtcbiAgICAgICAgdGhpcy5maWxsZXJFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLmZpbGxlckVsLnN0eWxlLmhlaWdodCA9IHRoaXMuZWwub2Zmc2V0SGVpZ2h0ICsgJ3B4JztcbiAgICAgICAgdGhpcy5wYXJlbnRFbC5pbnNlcnRCZWZvcmUodGhpcy5maWxsZXJFbCwgdGhpcy5lbCk7XG4gICAgICB9XG5cbiAgICAgIE9iamVjdC5hc3NpZ24oXG4gICAgICAgIHRoaXMuZWwuc3R5bGUsXG4gICAgICAgIHtcbiAgICAgICAgICBwb3NpdGlvbjogJ2ZpeGVkJywgLy8gZml4ZWQgaXMgYSBsb3Qgc21vb3RoZXIgdGhhbiBhYnNvbHV0ZVxuICAgICAgICAgIGZsb2F0OiAnbm9uZScsXG4gICAgICAgICAgdG9wOiB0aGlzLnN0aWNreU9mZnNldFRvcCArICdweCcsXG4gICAgICAgICAgYm90dG9tOiAnaW5oZXJpdCcsXG4gICAgICAgIH0sXG4gICAgICAgIGR5blByb3BzXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICAvKipcbiAgICAgICAqIHN0aWtjeSBlbGVtZW50IGlzIGluIHRoZSBvcmlnaW5hbCBwb3NpdGlvblxuICAgICAgICovXG4gICAgICBpZiAodGhpcy5maWxsZXJFbCkge1xuICAgICAgICB0aGlzLnBhcmVudEVsLnJlbW92ZUNoaWxkKHRoaXMuZmlsbGVyRWwpOyAvLyBJRTExIGRvZXMgbm90IHdvcmsgd2l0aCBlbC5yZW1vdmUoKVxuICAgICAgICB0aGlzLmZpbGxlckVsID0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgT2JqZWN0LmFzc2lnbihcbiAgICAgICAgdGhpcy5lbC5zdHlsZSxcbiAgICAgICAge1xuICAgICAgICAgIHBvc2l0aW9uOiB0aGlzLm9yaWdpbmFsLnBvc2l0aW9uLFxuICAgICAgICAgIGZsb2F0OiB0aGlzLm9yaWdpbmFsLmZsb2F0LFxuICAgICAgICAgIHRvcDogdGhpcy5vcmlnaW5hbC50b3AsXG4gICAgICAgICAgYm90dG9tOiB0aGlzLm9yaWdpbmFsLmJvdHRvbSxcbiAgICAgICAgICB3aWR0aDogdGhpcy5vcmlnaW5hbC53aWR0aCxcbiAgICAgICAgICBsZWZ0OiB0aGlzLm9yaWdpbmFsLmxlZnQsXG4gICAgICAgIH0sXG4gICAgICAgIGR5blByb3BzXG4gICAgICApO1xuICAgIH1cbiAgfTtcbn1cbiJdfQ==