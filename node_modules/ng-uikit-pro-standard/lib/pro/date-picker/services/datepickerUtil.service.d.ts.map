{"version":3,"file":"datepickerUtil.service.d.ts","sources":["../../../../../../projects/ng-uikit-pro-standard/src/lib/pro/date-picker/services/datepickerUtil.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { IMyDate } from '../interfaces/date.interface';\r\nimport { IMyDateRange } from '../interfaces/dateRange.interface';\r\nimport { IMyMonth } from '../interfaces/month.interface';\r\nimport { IMyMonthLabels } from '../interfaces/monthLabels.interface';\r\nimport { IMyMarkedDates } from '../interfaces/markedDates.interface';\r\nimport { IMyMarkedDate } from '../interfaces/markedDate.interface';\r\nimport { IMyDateFormat } from '../interfaces/my-date-format.interface';\r\n\r\nconst M = 'm';\r\nconst D = 'd';\r\n\r\n@Injectable()\r\nexport class UtilService {\r\n  isDateValid(\r\n    dateStr: string,\r\n    dateFormat: string,\r\n    minYear: number,\r\n    maxYear: number,\r\n    disableUntil: IMyDate,\r\n    disableSince: IMyDate,\r\n    disableWeekends: boolean,\r\n    disableDays: Array<IMyDate | number>,\r\n    disableDateRanges: Array<IMyDateRange>,\r\n    monthLabels: IMyMonthLabels,\r\n    enableDays: Array<IMyDate | number>\r\n  ): IMyDate {\r\n    const returnDate: IMyDate = { day: 0, month: 0, year: 0 };\r\n    const daysInMonth: Array<number> = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\r\n    if (monthLabels === undefined) {\r\n    }\r\n\r\n    const delimeters: Array<string> = this.getDateFormatDelimeters(dateFormat);\r\n\r\n    const dateValue: Array<IMyDateFormat> = this.getDateValue(dateStr, dateFormat, delimeters);\r\n    const year: number = this.getNumberByValue(dateValue[0]);\r\n    const month: number = this.getNumberByValue(dateValue[1]);\r\n    const day: number = this.getNumberByValue(dateValue[2]);\r\n\r\n    if (day !== -1 && month !== -1 && year !== -1) {\r\n      if (year < minYear || year > maxYear || month < 1 || month > 12) {\r\n        return returnDate;\r\n      }\r\n\r\n      const date: IMyDate = { year: year, month: month, day: day };\r\n\r\n      if (\r\n        this.isDisabledDay(\r\n          date,\r\n          disableUntil,\r\n          disableSince,\r\n          disableWeekends,\r\n          disableDays,\r\n          disableDateRanges,\r\n          enableDays\r\n        )\r\n      ) {\r\n        return returnDate;\r\n      }\r\n\r\n      if (year % 400 === 0 || (year % 100 !== 0 && year % 4 === 0)) {\r\n        daysInMonth[1] = 29;\r\n      }\r\n\r\n      if (day < 1 || day > daysInMonth[month - 1]) {\r\n        return returnDate;\r\n      }\r\n\r\n      // Valid date\r\n      return date;\r\n    }\r\n    return returnDate;\r\n  }\r\n\r\n  getDateValue(\r\n    dateStr: string,\r\n    dateFormat: string,\r\n    delimeters: Array<string>\r\n  ): Array<IMyDateFormat> {\r\n    let del: string = delimeters[0];\r\n    if (delimeters[0] !== delimeters[1]) {\r\n      del = delimeters[0] + delimeters[1];\r\n    }\r\n    const re: any = new RegExp('[' + del + ']');\r\n    const ds: Array<string> = dateStr.split(re);\r\n    const df: Array<string> = dateFormat.split(re);\r\n    const da: Array<IMyDateFormat> = [];\r\n\r\n    for (let i = 0; i < df.length; i++) {\r\n      if (df[i].indexOf('yy') !== -1) {\r\n        da[0] = { value: ds[i], format: df[i] };\r\n      }\r\n      if (df[i].indexOf(M) !== -1) {\r\n        da[1] = { value: ds[i], format: df[i] };\r\n      }\r\n      if (df[i].indexOf(D) !== -1) {\r\n        da[2] = { value: ds[i], format: df[i] };\r\n      }\r\n    }\r\n    return da;\r\n  }\r\n\r\n  getMonthNumberByMonthName(df: IMyDateFormat, monthLabels: IMyMonthLabels): number {\r\n    if (df.value) {\r\n      for (let key = 1; key <= 12; key++) {\r\n        if (df.value.toLowerCase() === monthLabels[key].toLowerCase()) {\r\n          return key;\r\n        }\r\n      }\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  getNumberByValue(df: IMyDateFormat): number {\r\n    if (!/^\\d+$/.test(df.value)) {\r\n      return -1;\r\n    }\r\n\r\n    let nbr: number = Number(df.value);\r\n    if (\r\n      (df.format.length === 1 && df.value.length !== 1 && nbr < 10) ||\r\n      (df.format.length === 1 && df.value.length !== 2 && nbr >= 10)\r\n    ) {\r\n      nbr = -1;\r\n    } else if (df.format.length === 2 && df.value.length > 2) {\r\n      nbr = -1;\r\n    }\r\n    return nbr;\r\n  }\r\n\r\n  getDateFormatSeparator(dateFormat: string): string {\r\n    return dateFormat.replace(/[dmy]/g, '')[0];\r\n  }\r\n\r\n  getDateFormatDelimeters(dateFormat: string): Array<string> | any {\r\n    return dateFormat.match(/[^(dmy)]{1,}/g);\r\n  }\r\n\r\n  isMonthLabelValid(monthLabel: string, monthLabels: IMyMonthLabels): number {\r\n    for (let key = 1; key <= 12; key++) {\r\n      if (monthLabel.toLowerCase() === monthLabels[key].toLowerCase()) {\r\n        return key;\r\n      }\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  isYearLabelValid(yearLabel: number, minYear: number, maxYear: number): number {\r\n    if (yearLabel >= minYear && yearLabel <= maxYear) {\r\n      return yearLabel;\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  parseDatePartNumber(dateFormat: string, dateString: string, datePart: string): number {\r\n    const pos: number = this.getDatePartIndex(dateFormat, datePart);\r\n    if (pos !== -1) {\r\n      const value: string = dateString.substring(pos, pos + datePart.length);\r\n      if (!/^\\d+$/.test(value)) {\r\n        return -1;\r\n      }\r\n      return parseInt(value, 0);\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  parseDatePartMonthName(\r\n    dateFormat: string,\r\n    dateString: string,\r\n    datePart: string,\r\n    monthLabels: IMyMonthLabels\r\n  ): number {\r\n    const pos: number = this.getDatePartIndex(dateFormat, datePart);\r\n    if (pos !== -1) {\r\n      return this.isMonthLabelValid(dateString.substring(pos, pos + datePart.length), monthLabels);\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  getDatePartIndex(dateFormat: string, datePart: string): number {\r\n    return dateFormat.indexOf(datePart);\r\n  }\r\n\r\n  parseDefaultMonth(monthString: string | any): IMyMonth {\r\n    const month: IMyMonth = { monthTxt: '', monthNbr: 0, year: 0 };\r\n    if (monthString !== '') {\r\n      const split = monthString.split(monthString.match(/[^0-9]/)[0]);\r\n      month.monthNbr = split[0].length === 2 ? parseInt(split[0], 0) : parseInt(split[1], 0);\r\n      month.year = split[0].length === 2 ? parseInt(split[1], 0) : parseInt(split[0], 0);\r\n    }\r\n    return month;\r\n  }\r\n\r\n  isDisabledDay(\r\n    date: IMyDate,\r\n    disableUntil: IMyDate,\r\n    disableSince: IMyDate,\r\n    disableWeekends: boolean,\r\n    disableDays: Array<IMyDate | number>,\r\n    disableDateRanges: Array<IMyDateRange>,\r\n    enableDays: Array<IMyDate | number>\r\n  ): boolean {\r\n    for (const e of enableDays) {\r\n      if (typeof e === 'number') {\r\n        if (e === this.getDayNumber(date)) {\r\n          return false;\r\n        }\r\n      } else if (e.year === date.year && e.month === date.month && e.day === date.day) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    const dateMs: number = this.getTimeInMilliseconds(date);\r\n    if (\r\n      this.isInitializedDate(disableUntil) &&\r\n      dateMs <= this.getTimeInMilliseconds(disableUntil)\r\n    ) {\r\n      return true;\r\n    }\r\n\r\n    if (\r\n      this.isInitializedDate(disableSince) &&\r\n      dateMs >= this.getTimeInMilliseconds(disableSince)\r\n    ) {\r\n      return true;\r\n    }\r\n\r\n    if (disableWeekends) {\r\n      const dn = this.getDayNumber(date);\r\n      if (dn === 0 || dn === 6) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    for (const d of disableDays) {\r\n      if (typeof d === 'number') {\r\n        if (this.getDayNumber(date) === d) {\r\n          return true;\r\n        }\r\n      } else if (d.year === date.year && d.month === date.month && d.day === date.day) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    for (const d of disableDateRanges) {\r\n      if (\r\n        this.isInitializedDate(d.begin) &&\r\n        this.isInitializedDate(d.end) &&\r\n        dateMs >= this.getTimeInMilliseconds(d.begin) &&\r\n        dateMs <= this.getTimeInMilliseconds(d.end)\r\n      ) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  isMarkedDate(\r\n    date: IMyDate,\r\n    markedDates: Array<IMyMarkedDates>,\r\n    markWeekends: IMyMarkedDate\r\n  ): IMyMarkedDate {\r\n    for (const md of markedDates) {\r\n      for (const d of md.dates) {\r\n        if (d.year === date.year && d.month === date.month && d.day === date.day) {\r\n          return { marked: true, color: md.color };\r\n        }\r\n      }\r\n    }\r\n    if (markWeekends && markWeekends.marked) {\r\n      const dayNbr = this.getDayNumber(date);\r\n      if (dayNbr === 0 || dayNbr === 6) {\r\n        return { marked: true, color: markWeekends.color };\r\n      }\r\n    }\r\n    return { marked: false, color: '' };\r\n  }\r\n\r\n  getWeekNumber(date: IMyDate): number {\r\n    const d: Date = new Date(date.year, date.month - 1, date.day, 0, 0, 0, 0);\r\n    d.setDate(d.getDate() + (d.getDay() === 0 ? -3 : 4 - d.getDay()));\r\n    return Math.round((d.getTime() - new Date(d.getFullYear(), 0, 4).getTime()) / 86400000 / 7) + 1;\r\n  }\r\n\r\n  isMonthDisabledByDisableUntil(date: IMyDate, disableUntil: IMyDate): boolean {\r\n    return (\r\n      this.isInitializedDate(disableUntil) &&\r\n      this.getTimeInMilliseconds(date) <= this.getTimeInMilliseconds(disableUntil)\r\n    );\r\n  }\r\n\r\n  isMonthDisabledByDisableSince(date: IMyDate, disableSince: IMyDate): boolean {\r\n    return (\r\n      this.isInitializedDate(disableSince) &&\r\n      this.getTimeInMilliseconds(date) >= this.getTimeInMilliseconds(disableSince)\r\n    );\r\n  }\r\n\r\n  isInitializedDate(date: IMyDate): boolean {\r\n    return date.year !== 0 && date.month !== 0 && date.day !== 0;\r\n  }\r\n\r\n  getTimeInMilliseconds(date: IMyDate): number {\r\n    return new Date(date.year, date.month - 1, date.day, 0, 0, 0, 0).getTime();\r\n  }\r\n\r\n  getDayNumber(date: IMyDate): number {\r\n    const d: Date = new Date(date.year, date.month - 1, date.day, 0, 0, 0, 0);\r\n    return d.getDay();\r\n  }\r\n}\r\n"]}